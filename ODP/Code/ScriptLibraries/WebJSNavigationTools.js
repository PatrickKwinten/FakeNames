/*	js lib:		WebJSNavigationTools	description:	service functions for action bar buttons				variables are saved in the parent frame, therefor these function work only				in a framed environment - fall back functions are implemented for a non framed environment*/var sMsgSubmitted	= 'Your document has been successfully submitted';var isTop			= window == top;var isEF			= !isTop && parent.frames.frEFSrvResponse != null;		// is edit frameworkfunction ntInit() {	// save view where we are coming from	if (!isTop) {		var sUrl = location.href.toUpperCase();				if (window.sElementType == 'view') {					// we are in the $$ViewTemplateDefault						if (sUrl.search(/openview|start=/i) > -1) {				parent.sNTLastOpenView	= window.location.href;				parent.sNTLastSearch	= null;				parent.sNTDefaultView	= null;			}					} else {			// we are in a form						if (document.referrer.search(/openview|start=/i) > -1 & 			    document.referrer.search(/searchview/i) == -1) {				parent.sNTLastOpenView	= document.referrer				parent.sNTLastSearch	= null				parent.sNTDefaultView	= null			} else if (document.referrer.search(/searchview/i) > -1 &					 sUrl.search(/searchview/i) == -1) {				// we are coming from a search result				parent.sNTLastSearch	= document.referrer			}						// get default view			if (window.sDefaultView) {				parent.sNTDefaultView = window.sDefaultView			}						// check for special cases - currently used in webadmin			// if there was an opendocument command with a &SaveAndReopen parameter			// the document will be reopened in read mode after it was saved 			// or the cancel button was pressed,			// this also works for new response documents, created in the opened document			if (sUrl.search(/opendocument/i) > -1 && sUrl.search(/&SaveAndReopen/i) > -1) {				// save reopen url				parent.sNTReturnUrl		= sUrl;				parent.sNTReopenDocUNID	= location.pathname.substring(location.pathname.lastIndexOf('/') + 1).toUpperCase();			}			// reset the reopen url if the doc UNID is not found in the url			if (sUrl.indexOf(parent.sNTReopenDocUNID) == -1) {				parent.sNTReturnUrl		= null			}			if (sUrl.indexOf(parent.parent.sNTReopenDocUNID) == -1) {				parent.parent.sNTReturnUrl	= null			}			if (sUrl.search(/opendocument/i) > -1 && sUrl.search(/&form=/i) > -1) {				// get form overwrite				parent.sNTFormDocUNID	= location.pathname.substring(location.pathname.lastIndexOf('/') + 1).toUpperCase();				parent.sFormOverwrite	= strUrlParam(window.location.href, 'form');			}			// reset the form overwrite if the doc UNID is not found in the url			if (sUrl.indexOf(parent.sNTFormDocUNID) == -1) {				parent.sNTFormDocUNID	= null			}			if (sUrl.indexOf(parent.parent.sNTFormDocUNID) == -1) {				parent.parent.sNTFormDocUNID	= null			}		}	}}ntInit()function ntOnLoad() {	if (document.forms.length == 0) return		hForm = document.forms[0]		// do nothing if form has no action defined	if (hForm.action == '') return		// disable &TableRow parameter from action	hForm.action = hForm.action.replace(/&TableRow/i, '&Dummy')}onload = ntOnLoad// ----------------------------------- Action buttons --------------------------------------function ntEditDoc(sRole, sView, sOptParams, sPassthrough) {	// called when clicked on an edit button - open current document in edit mode	// set default for optional arguments	sView		= sView || window.sDefaultView	sPassthrough	= '&Passthrough=' + (sPassthrough || '')	sOptParams	= sOptParams || ''	// open in edit framework if we are not in it - add table row parameter	sPassthrough	+= (isEF ? '' : '$1EditFramework')	sPassthrough	+= (parent.sFormOverwrite ? '$1form$2' + parent.sFormOverwrite : '')	// Construct URL for launching the agent 	var sPathname	= window.location.pathname	var sPath		= window.sWebDbName	var sUNID		= sPathname.substr(sPathname.lastIndexOf('/') + 1);	var sTableRow	= strUrlParam(window.location.search.toUpperCase(), 'TABLEROW')	sPassthrough	+= sTableRow == '' ? '' : strEscapePassthrough('&TableRow=' + sTableRow, false)	var sParam	= '&UNID=' + sUNID + '&Role=' + sRole + '&View=' + sView + sOptParams + sPassthrough;	window.location = sPath + 'wAuthenticate?OpenAgent&ReqId=EditDocument&' + escape(sParam);}function ntNewDoc(sForm, sRole, sView, sOptParams, sPassthrough) {	// called when clicked on a add button - open requested form		// set default for optional parameters	sView		= sView || window.sViewName	sPassthrough	= '&Passthrough=' + (sPassthrough || '');	sOptParams	= sOptParams || '';		// open in edit framework if we are not yet in there	sPassthrough	+= (isEF ? '' : '$1EditFramework');		// Construct URL for launching the agent 	var sPathname	= window.location.pathname;	var sPath		= (window.sWebDbName == null ?					sPathname.substring(0,(sPathname.lastIndexOf('.nsf')+5)) :					window.sWebDbName);	var sParam	= '&Form=' + sForm + '&Role=' + sRole + '&View=' + sView + sOptParams + sPassthrough;	window.location = sPath + 'wAuthenticate?OpenAgent&ReqId=NewDocument&' + escape(sParam);}function ntCancel() {	// called when clicked on a cancel button - return to the last opened view	or search result		if (isTop) {		// non framed environment - 'simple' cancel		history.back()	} else {			if (parent.sNTReturnUrl) {			location.replace(parent.sNTReturnUrl)					} else if (parent.parent.sNTReturnUrl) {			parent.location.replace(parent.parent.sNTReturnUrl)					} else if (parent.sNTLastSearch) {			var sUrl = parent.sNTLastSearch			parent.sNTLastSearch = null			location.replace(sUrl)					} else if (parent.parent.sNTLastSearch) {			var sUrl = parent.parent.sNTLastSearch			parent.parent.sNTLastSearch = null			parent.location.replace(sUrl)		} else if (parent.sNTLastOpenView) {						location.replace(parent.sNTLastOpenView)					} else if (parent.parent.sNTLastOpenView) {			parent.location.replace(parent.parent.sNTLastOpenView)					} else {			history.back()			}	}}function ntSaveAndClose() {	// called when clicked on save & close button	var hForm = document.forms[0]		if (isEF) {		// we are in the edit framework - set reponse target to hidden frame		hForm.target = 'frEFSrvResponse'	}	if (hForm.onsubmit) {		var retVal = hForm.onsubmit()		if (typeof retVal == "boolean" && retVal == false)		return false	}		hForm.submit()}// ----------------------------------- $$Return --------------------------------------function ntReturn() {	// called from $$return output - write response html into the body 	if (isEF) {			if (parent.parent.sNTLastOpenView == null && parent.parent.sNTReturnUrl == null) {			// the view or document was not opened in a frameset			parent.frames.location.href = sWebDbName + 'ConfirmDocIsSaved?OpenPage'		} else {					ntCancel()		}	} else {			document.writeln('<hr><span class="Bold">' + sMsgSubmitted + '</span><br><hr>')	}}// ----------------------------------- Error Handling -------------------------------------function ntValidationFailure(sError) {	// called from an @Failure	if (isEF) {		alert(unescape(sError))	} else {		document.writeln('<hr><span class="Bold">' + sError + '</span><br><hr>')	}}function ntGeneralError(sError) {	// called from $$ReturnGeneralError		if (isEF) {		alert(sError)	}}